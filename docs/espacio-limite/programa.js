import{LinearAccelerationSensor as t}from"motion-sensors-polyfill";import e from"eventemitter3";class i{constructor(t,e){Object.assign(this,{x:t.x,y:t.y,z:t.z}),this.bias=e}update(t){this.x=this.x*this.bias+t.x*(1-this.bias),this.y=this.y*this.bias+t.y*(1-this.bias),this.z=this.z*this.bias+t.z*(1-this.bias)}}function s(t,e){return Math.floor(Math.random()*(e-t))+t}class n{constructor(t=0,e=0,i=0){this.x=t||0,this.y=e||0,this.z=i||0}definir(t,e,i){return this.x=t,this.y=e,this.z=i,this}definirX(t){return this.x=t,this}definirY(t){return this.y=t,this}definirZ(t){return this.z=t,this}sumar(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sumarEscala(t){return this.x+=t,this.y+=t,this.z+=t,this}restar(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}restarEscala(t){return this.x-=t,this.y-=t,this.z-=t,this}restarVectores(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiplicar(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplicarEscala(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this}multiplicarVectores(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}dividir(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}dividirEscala(t){return this.multiplicarEscala(1/t)}longitudCuadrado(){return this.x*this.x+this.y*this.y+this.z*this.z}longitud(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}asignarLongitud(t){return this.multiplicarEscala(t/this.longitud())}distanciaA(t){return Math.sqrt(this.distanciaAlCuadrado(t))}normalizar(){return this.dividirEscala(this.longitud())}distanciaAlCuadrado(t){var e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}esIgual(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}copiarDesde(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}}class o{constructor(t,e){this.url=e,this.solicitud=new XMLHttpRequest,this.peso=0,this.cargado=!1,this.tipo=t,this.totalCargado=0,this.elemento}}const r=document.getElementById("mensajes"),a=r.querySelector("#texto");var l=()=>{r.classList.add("esconder")},h=t=>{a.innerText=`...\n\n${t}\n...`},d=[{vector:new n(216,338),distMin:100,ele:null,tipo:"texto",mensaje:"HOLA!"},{vector:new n(1052,427),distMin:100,ele:null,tipo:"imagen",url:",,,,",mensaje:""},{vector:new n(1864,207),distMin:100,ele:null,tipo:"video",url:"..."},{vector:new n(2344,214),distMin:100,ele:null,tipo:"sonido",url:"..."},{vector:new n(1648,607),distMin:100,ele:null},{vector:new n(3845,718),distMin:100,ele:null},{vector:new n(1568,1488),distMin:100,ele:null},{vector:new n(118,1750),distMin:100,ele:null},{vector:new n(3191,1800),distMin:100,ele:null},{vector:new n(2797,1887),distMin:100,ele:null},{vector:new n(100,2179),distMin:100,ele:null},{vector:new n(2168,2456),distMin:100,ele:null},{vector:new n(1258,2589),distMin:100,ele:null},{vector:new n(1937,2893),distMin:100,ele:null},{vector:new n(268,3605),distMin:100,ele:null}];const c=document.getElementById("iniciar"),u=document.getElementById("consola"),g=document.getElementById("plano"),p=g.getContext("2d");let m=0;const y=new n,x=new n,w=new class extends e{constructor(){super(),this._pesoTotal=0,this._pesosDefinidos=0,this._pesoCargado=0,this._totalCargados=0,this.fila=[]}agregar(t){this.fila=[...this.fila,...t]}cargar(){this.emit("iniciandoPrecarga"),this.fila.forEach((t=>{const e=t.solicitud,i={tipo:t.tipo,url:t.url};switch(t.tipo){case"imagen":e.responseType="blob";break;case"sonido":e.responseType="arraybuffer"}e.open("GET",t.url,!0),e.onloadstart=()=>this.emit("cargandoElemento",i),e.onloadend=()=>this.emit("elementoCargado",i),e.onprogress=e=>this._actualizarProgreso(e,t),e.onerror=t=>this.emit("errorCargandoElemento",{...i,error:t}),e.onload=()=>{if(200!==e.status)throw new Error(`Problema cargando elemento ${t.url} del servidor`);if("imagen"===t.tipo){const i=new Image;i.onload=()=>{this._totalCargados++,t.cargado=!0,t.elemento=i,t.centro={x:i.naturalWidth/2,y:i.naturalHeight/2},this._revisar()},i.src=URL.createObjectURL(e.response)}else t.elemento=e.response,t.cargado=!0,this._revisar()},e.send(null)}))}_reiniciarCargador(){this._pesoTotal=0,this._pesosDefinidos=0,this._pesoCargado=0,this._totalCargados=0,this.fila=[]}_actualizarProgreso(t,e){t.lengthComputable?(0===e.peso&&(e.peso=t.total,this._pesoTotal+=t.total,this._pesosDefinidos++),this._pesosDefinidos===this.fila.length&&(e.totalCargado=t.loaded,this._pesoCargado=this.fila.map((t=>t.totalCargado)).reduce(((t,e)=>t+e)),this.emit("progreso",{porcentajeCargado:Math.floor(this._pesoCargado/this._pesoTotal*100),totalElementosCargando:this.fila.length}))):e.solicitud.onprogress=null}_revisar(){this._totalCargados===this.fila.length&&(this._reiniciarCargador(),this.emit("listo"))}},v=new o("imagen","8eb47464a8bb1d59.jpg"),f=new o("imagen","a4894765934652e1.png");function z(){const t=v.elemento,e=y.x,i=y.y;p.clearRect(0,0,g.width,g.height),p.save(),p.translate(g.width/2,g.height/2),p.rotate(m),p.drawImage(t,y.x,y.y),p.restore(),d.forEach((t=>{const s=new n(t.vector.x+e,t.vector.y+i);t.ele||(t.ele=function(){const t=document.createElement("span"),e=document.createElement("span");return t.className="circulo",e.className="onda",t.appendChild(e),M.appendChild(t),t}()),t.hasOwnProperty("pos")||(t.pos=s)}))}function E(){const t=f.elemento;z(),p.drawImage(t,x.x-f.centro.x,x.y-f.centro.y)}function C(){const t=window.innerWidth,e=window.innerHeight;g.width=t,g.height=e,x.x=t/2|0,x.y=e/2|0}w.agregar([v,f]),w.on("progreso",(t=>{h(`${t.porcentajeCargado}%`)})),w.on("listo",(function(){c.classList.remove("esconder"),l();const e=v.elemento;C(),y.x=s(0,-e.naturalWidth+g.width),y.y=s(0,-e.naturalHeight+g.height),console.log(y),z(),c.onclick=()=>{var e;document.getElementById("intro").style.display="none",E(),e=t=>{m=t.alpha*(Math.PI/180),E()},window.DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&window.addEventListener("deviceorientation",e,!1)})).catch(console.error):window.addEventListener("deviceorientation",e,!1);let s=!1,n=0;const o=new t({frequency:50}),r=new i(o,.8);o.onreading=()=>{if(r.update(o),r.y>.65)s=!0;else if(s){n++,u.innerText=`pasos: ${n}`,s=!1;const t=30*Math.sin(m),e=30*Math.cos(m);m>=0?(y.x-=t,y.y-=e):(y.x+=t,y.y+=e)}},o.start()},window.onresize=C})),w.cargar();const M=document.getElementById("ondas");g.onmousemove=t=>{y.x=t.clientX,y.y=t.clientY,d.forEach((t=>{const e=y.distanciaA(t.pos);console.log(e),e<=t.distMin?(console.log(y),t.ele.classList.contains("prendido")||t.ele.classList.add("prendido"),t.ele.style.transform=`translate(${t.pos.x-150}px, ${t.pos.y-150}px)`):t.ele.classList.remove("prendido")}))};
//# sourceMappingURL=programa.js.map
